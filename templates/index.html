<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jamaican True Stories • Dream Interpreter</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0b0e;
      --panel:#121218;
      --ink:#e9e9ef;
      --muted:#b7b7c2;
      --gold:#d4af37;
      --gold-2:#b8921e;
      --red:#f87171;
      --edge:#2b2730;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(212,175,55,.07), transparent 60%),
        var(--bg);
      color:var(--ink);
      font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
      display:flex; align-items:center; justify-content:center;
      padding:32px;
    }

    .card{
      width:min(880px,100%);
      background:
        linear-gradient(180deg, rgba(212,175,55,.05), transparent 160px),
        var(--panel);
      border:1px solid rgba(212,175,55,.18);
      border-radius:20px;
      box-shadow:0 10px 30px rgba(0,0,0,.45);
      padding:28px 24px 22px;
      position:relative; overflow:hidden;
    }
    .card::before{
      content:""; position:absolute; inset:0; pointer-events:none; opacity:.18;
      background-image:
        radial-gradient(rgba(255,255,255,.09) 1px, transparent 1.2px),
        radial-gradient(rgba(255,255,255,.06) 1px, transparent 1.2px);
      background-size:3px 3px,5px 5px; background-position:0 0, 10px 8px;
    }

    .brand{display:flex; align-items:center; gap:14px; margin-bottom:12px; position:relative; z-index:1;}
    .logo{
      width:56px; height:56px; border-radius:50%;
      object-fit:cover; background:#0e0e14;
      border:1px solid rgba(212,175,55,.35);
      box-shadow: inset 0 0 0 1px rgba(212,175,55,.14), 0 0 18px rgba(212,175,55,.18);
    }
    .brand-text{display:flex; flex-direction:column}
    h1{
      font-family:Cinzel,serif; font-weight:700; letter-spacing:.5px;
      margin:0; font-size:1.35rem;
      text-shadow:0 0 16px rgba(212,175,55,.18);
    }
    .sub{color:var(--muted); margin:6px 0 22px; font-size:.95rem}

    label.mini{color:var(--muted); font-size:.85rem}
    textarea{
      width:100%; min-height:140px;
      background:#0e0e14; color:var(--ink);
      border:1px solid rgba(212,175,55,.2); border-radius:14px;
      padding:14px 14px 42px 14px;
      outline:none; resize:vertical; caret-color:var(--gold);
      box-shadow:inset 0 0 0 1px rgba(212,175,55,.06);
    }
    .controls{display:flex; gap:12px; align-items:center; justify-content:space-between; margin-top:10px;}
    .mini{color:var(--muted); font-size:.85rem}

    .btn{
      appearance:none; border:none; border-radius:999px; padding:12px 18px; font-weight:600; cursor:pointer;
      background:linear-gradient(180deg, var(--gold), var(--gold-2)); color:#0b0b0e;
      box-shadow:0 6px 18px rgba(212,175,55,.25);
    }
    .btn:disabled{opacity:.6; cursor:not-allowed; box-shadow:none}

    .samples{margin-top:6px; display:flex; flex-wrap:wrap; gap:8px}
    .chip{
      border:1px solid rgba(212,175,55,.22); color:var(--ink);
      padding:6px 10px; border-radius:999px; font-size:.85rem; cursor:pointer;
      background:#0b0b11;
    }

    .result{margin-top:18px; border:1px solid rgba(212,175,55,.18); border-radius:16px; background:#0f0f15; padding:16px;}
    .result h3{margin:0 0 8px; font-family:Cinzel,serif; font-size:1.05rem; color:var(--gold)}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace; font-size:.9rem; color:#dcdcf4}
    .err{color:var(--red)}
    .footer{margin-top:14px; color:var(--muted); font-size:.85rem}
    a{color:var(--gold)}
  </style>
</head>
<body>
  <main class="card">
    <div class="brand">
      <img class="logo" src="https://cdn.shopify.com/s/files/1/0740/7245/7431/files/transparent_jts_logo.png?v=1749773424" alt="Jamaican True Stories logo">
      <div class="brand-text">
        <h1>Jamaican True Stories — Dream Interpreter</h1>
        <div class="sub">Type your dream below. We’ll search your meanings and return a clear, gentle interpretation.</div>
      </div>
    </div>

    <label for="dream" class="mini">Your dream</label>
    <textarea id="dream" placeholder="Example: I was riding a bicycle…"></textarea>

    <div class="controls">
      <div class="mini" id="count">0 characters</div>
      <button id="go" class="btn">Interpret Dream</button>
    </div>

    <div class="samples mini">
      Try:
      <span class="chip">“teeth falling out”</span>
      <span class="chip">“snake bite on my hand”</span>
      <span class="chip">“running late for an exam”</span>
      <span class="chip">“flying over the sea at night”</span>
    </div>

    <section id="out" class="result" style="display:none">
      <h3>Interpretation</h3>
      <div id="interp"></div>
      <div class="mini" style="margin-top:8px">
        Method: <span class="mono" id="method">—</span>
        <span id="scoreWrap" style="display:none"> • Score: <span class="mono" id="score">—</span></span>
      </div>
    </section>

    <div class="footer">Health: <a href="/healthz" target="_blank">/healthz</a></div>
  </main>

  <script>
    const txt = document.getElementById('dream');
    const btn = document.getElementById('go');
    const out = document.getElementById('out');
    const interp = document.getElementById('interp');
    const methodEl = document.getElementById('method');
    const scoreWrap = document.getElementById('scoreWrap');
    const scoreEl = document.getElementById('score');
    const count = document.getElementById('count');

    txt.addEventListener('input', () => {
      count.textContent = `${txt.value.length} characters`;
    });

    document.querySelectorAll('.chip').forEach(c =>
      c.addEventListener('click', () => {
        txt.value = c.textContent.replace(/^“|”$/g, '');
        txt.dispatchEvent(new Event('input'));
      })
    );

    async function run() {
      const dream = txt.value.trim();
      if (!dream) { txt.focus(); return; }
      btn.disabled = true; btn.textContent = 'Interpreting…';
      out.style.display = 'none';
      interp.textContent = ''; methodEl.textContent = '—';
      scoreWrap.style.display = 'none';

      try {
        const res = await fetch('/interpret', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ dream })   // ✅ send { dream }
        });
        const data = await res.json();

        out.style.display = 'block';

        // Expect { interpretation: string, meta?: object }
        if (data.interpretation) {
          interp.textContent = data.interpretation;
        } else {
          interp.innerHTML = `<span class="err">${data.error || 'No response'}</span>`;
        }

        const m = data.meta || {};
        methodEl.textContent = m.method || m.status || '—';
        if (typeof m.score === 'number') {
          scoreWrap.style.display = 'inline';
          scoreEl.textContent = m.score.toFixed(3);
        }
      } catch (e) {
        out.style.display = 'block';
        interp.innerHTML = `<span class="err">Network error. Please try again.</span>`;
        methodEl.textContent = '—';
        scoreWrap.style.display = 'none';
      } finally {
        btn.disabled = false; btn.textContent = 'Interpret Dream';
      }
    }

    btn.addEventListener('click', run);
    txt.addEventListener('keydown', (e) => {
      if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') run();
    });
  </script>
</body>
</html>
